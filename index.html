
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.4">
    
    
      
        <title>MSA (Multi-perturbation Shapley value Analysis)</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#motivation-such" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="MSA (Multi-perturbation Shapley value Analysis)" class="md-header__button md-logo" aria-label="MSA (Multi-perturbation Shapley value Analysis)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSA (Multi-perturbation Shapley value Analysis)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="MSA (Multi-perturbation Shapley value Analysis)" class="md-nav__button md-logo" aria-label="MSA (Multi-perturbation Shapley value Analysis)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MSA (Multi-perturbation Shapley value Analysis)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="index.html" class="md-nav__link md-nav__link--active">
        Home
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation-such" class="md-nav__link">
    Motivation &amp; such:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-in-python" class="md-nav__link">
    How it works in Python:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-interface" class="md-nav__link">
    The Interface:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo-interested-in-contributing" class="md-nav__link">
    TODO (Interested in Contributing?):
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cite" class="md-nav__link">
    Cite:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgement" class="md-nav__link">
    Acknowledgement:
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/estimate_causal_influences.html" class="md-nav__link">
        Estimate causal influences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/interface.html" class="md-nav__link">
        Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/make_combination_space.html" class="md-nav__link">
        Make combination space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/make_complement_space.html" class="md-nav__link">
        Make complement space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/make_permutation_space.html" class="md-nav__link">
        Make permutation space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/make_shapley_values.html" class="md-nav__link">
        Make shapley values
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="API/take_contributions.html" class="md-nav__link">
        Take contributions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Plotting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plotting" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Plotting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Plotting/color_code.html" class="md-nav__link">
        Color code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Plotting/plot_shapley_ranks.html" class="md-nav__link">
        Plot shapley ranks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/bootstrap_hypothesis_testing.html" class="md-nav__link">
        Bootstrap hypothesis testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/distribution_of_processing.html" class="md-nav__link">
        Distribution of processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/generatorize.html" class="md-nav__link">
        Generatorize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/parallelized_take_contributions.html" class="md-nav__link">
        Parallelized take contributions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/ray_iterator.html" class="md-nav__link">
        Ray iterator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="Utils/sorter.html" class="md-nav__link">
        Sorter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="examples/brain%20modes.html" class="md-nav__link">
        Capturing contributions in different 'brain modes'
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="examples/minimal.html" class="md-nav__link">
        Minimal examples of how to use MSA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="examples/on%20ground-truth%20models.html" class="md-nav__link">
        Working with groundtruth models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation-such" class="md-nav__link">
    Motivation &amp; such:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-in-python" class="md-nav__link">
    How it works in Python:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-interface" class="md-nav__link">
    The Interface:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo-interested-in-contributing" class="md-nav__link">
    TODO (Interested in Contributing?):
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cite" class="md-nav__link">
    Cite:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgement" class="md-nav__link">
    Acknowledgement:
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Home</h1>

<p><center><h3>(work in progress)</h3></center></p>
<p><img align="left" src="images/Artboard%202.jpg" alt="msa logo" width="300"> </p>
<p>TLDR: 
A Game theoretical approach for calculating the contribution of each element of a system (here network models of the brain) to a system-wide description of the system. The classic neuroscience example: How much each brain region is causally relevant to an arbitrary cognitive function. </p>
<h2 id="motivation-such">Motivation &amp; such:</h2>
<p>MSA is developed by Keinan and colleagues back in 2004, the motivation for them was to have a causal picture of the system by lesioning its elements. The method itself is not new, if not the first, it was among one of the earliest ones used by neuroscientists to understand the brain. The reasoning is quite simple, let us study broken systems to see what's missing both from the brain and the behavior (or cognition) and assume that region was causally necessary for the emergence of that cognitive/behavioral state. What MSA does is to see this necessity as contribution. If the brain region is indeed the seed of this cognitive function (whatever this means) then its contribution should be very high while other regions will have near zero contribution. Having this in mind then we can see the whole scenario as a cooperative game in which a coalition of players work together and obtain some divisible outcome, then the question is quite the same. How to divide the outcome to the players in a "fair" way such that the most "important" player gets the biggest chunk. Shapley value is then that chunk! It is the result of a mathematically rigorous and axiomatic procedure that derives who should get how much from all possible combinations of coalitions and all ordering in which players can enter the game. Translating it to neuroscience, it derives a ranking of contributions from a dataset of all possible combinations of lesions. This means 2<sup>N</sup> lesions (assuming lesions are binary, either perturbed or not), which N is the number of brain regions. </p>
<p>As you probably noticed this won't be feasible to calclulate as for example, it means a total number of 4,503,599,627,370,496 lesion combinations, assuming the brain is organized as Broadmann said, i.e., with 52 regions. So we estimate! For a more detailed description visit:</p>
<p><a href="https://www.sciencedirect.com/science/article/abs/pii/S0925231204000426?via%3Dihub">Keinan, Alon, Claus C. Hilgetag, Isaac Meilijson, and Eytan Ruppin. 2004. “Causal Localization of Neural Function: The Shapley Value Method.” Neurocomputing 58-60 (June): 215–22.
</a></p>
<p><a href="https://direct.mit.edu/artl/article/12/3/333/2530/Axiomatic-Scalable-Neurocontroller-Analysis-via">Keinan, Alon, Ben Sandbank, Claus C. Hilgetag, Isaac Meilijson, and Eytan Ruppin. 2006. “Axiomatic Scalable Neurocontroller Analysis via the Shapley Value.” Artificial Life 12 (3): 333–52.</a></p>
<p>And our own recent work <a href="https://doi.org/10.1101/2021.11.04.467251">Kayson Fakhar, Claus C. Hilgetag. 2021. Systematic Perturbation of an Artificial Neural Network: A Step Towards Quantifying Causal Contributions in The Brain. bioRxiv 2021.11.04.467251</a></p>
<h2 id="installation">Installation:</h2>
<p>The easiest way is to <code>pip install msapy</code>, I wrote this package in Python <code>3.9</code> and tried it on <code>3.8</code> so, it's safe to say you need at least a Python <code>3.8</code> so easy-installing it on older versions is not an option. Alternatively you can clone the repository (<code>git clone https://github.com/kuffmode/msa.git</code>, move to the <code>msa</code> folder (<code>cd msa</code>), and run <code>pip install .</code> In case the requirements weren't installed automatically you can also use the command <code>pip install -r requirements.txt</code> and then let me know so I can fix it!</p>
<h2 id="how-it-works">How it works:</h2>
<p>Here you can see a schematic representation of how the algorithm works (interested in math instead? check the papers above). Briefly, all MSA needs from you is a list of players and a game function. The players can be your nodes, for example, brain regions or indices in a connectivity matrix, or links between them as tuples. It then shuffles them to produce N orderings in which they can join the game. This can end with repeating permutations if the set is small but that's fine don't worry! MSA then produces a "combination space" in which it produces all the combinations the player should form coalitions. Then it uses your game function and fills the contributions of those coalitions. The last step is to perform a Shapley integration and isolate each player's contribution in that given permutation. Repeating this for all permutations produces a contribution table (shapley table) and you'll get your shapley values by averaging over permutations so the end result is a value per element/player. To get a better grasp of how this works in code, check the minimal example in the examples folder.</p>
<p><img src="images/Artboard%201.jpg" alt="msa unbiased sampling algorithm"> </p>
<h2 id="how-it-works-in-python">How it works in Python:</h2>
<p>I tried to make the package compact and easy-to-use but still there are a few things to keep in mind. Please take a look at the examples but just to give a flavor let's start working with the set ABCD as we have in the above picture.</p>
<p>Importing will be just: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">msapy</span> <span class="kn">import</span> <span class="n">msa</span><span class="p">,</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
</code></pre></div>

<p>Then we define some elements and generate the permutation space:</p>
<div class="codehilite"><pre><span></span><code><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
<span class="n">permutation_space</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">make_permutation_space</span><span class="p">(</span><span class="n">n_permutations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
</code></pre></div>

<p>This results in a list of tuples, our permutation space that has 1000 permutations in it, here are the top 5 ones:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">)]</span>
</code></pre></div>

<p>Then we use this to produce our combination space:</p>
<div class="codehilite"><pre><span></span><code><span class="n">combination_space</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">make_combination_space</span><span class="p">(</span><span class="n">permutation_space</span><span class="o">=</span><span class="n">permutation_space</span><span class="p">)</span>
</code></pre></div>

<p>And a quick look of what's inside:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">(),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;C&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">}),</span>
 <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">})]</span>
</code></pre></div>

<p>As you can see eventhough the permutation space has 1000 permutations, the combination space is exhausted because the total number of possible combinations is 2<sup>4</sup> or 16. Now here's the trick, we need to assign values to these combinations (coalitions) by keeping them intact while every other element is perturbed. In other words, the contribution of coalition <code>{'B', 'C'}</code> is isolated if we lesion <code>{'A', 'D'}</code> before playing the game. So what we do (and is not in the figure above) is to produce the "complement space" of the combination space:</p>
<div class="codehilite"><pre><span></span><code><span class="n">complement_space</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">make_complement_space</span><span class="p">(</span><span class="n">combination_space</span><span class="o">=</span><span class="n">combination_space</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
</code></pre></div>

<p>that is the difference of what's in the combination space in that coalition and what is not:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,),</span>
 <span class="p">(),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)]</span>
</code></pre></div>

<p>As you can see, for example when combination is <code>{'D'}</code> the corresponding complement is <code>('C', 'B', 'A')</code>. Note the difference in types, combination space is an <code>OrderedSet</code> of <code>frozenset</code>s so the Shapley value calculations are quicker while complement space is an <code>OrderedSet</code> of <code>Tuples</code> So handling it in your objective function is easier. Speaking of, let's make the worst objective function that just produces random values regardless of what's what (see the example <code>on ground-truth models.ipynb</code> for a more elaborate version.)<a href="https://github.com/kuffmode/msa/blob/main/examples/on%20ground-truth%20models.ipynb">(see the example <code>on ground-truth models.ipynb</code> for a more elaborate version.)</a></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rnd</span><span class="p">(</span><span class="n">complements</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<p>We'll next play the games and aquire the contributions as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="n">contributions</span><span class="p">,</span> <span class="n">lesion_effects</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">take_contributions</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
                                        <span class="n">combination_space</span><span class="o">=</span><span class="n">combination_space</span><span class="p">,</span>
                                        <span class="n">complement_space</span><span class="o">=</span><span class="n">complement_space</span><span class="p">,</span>
                                        <span class="n">objective_function</span><span class="o">=</span><span class="n">rnd</span><span class="p">)</span>
</code></pre></div>

<p>Both <code>contributions</code> and <code>lesion_effects</code> are the same values just addressed differently. For example, if the contribution of coalition <code>{'B', 'C'}</code> is 5 points then you can also say the effect of lesioning coalition <code>{'A', 'D'}</code> is 5 points. This by itself is not that informative but if you know the contribution of the grand coalition (intact system) then you can claim that the effect of lesioning <code>{'A', 'D'}</code> is a drop of some performance from x to 5.</p>
<p>Lastly, you can calculate Shapley values like:</p>
<div class="codehilite"><pre><span></span><code><span class="n">shapley_table</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">make_shapley_values</span><span class="p">(</span><span class="n">contributions</span><span class="o">=</span><span class="n">contributions</span><span class="p">,</span><span class="n">permutation_space</span><span class="o">=</span><span class="n">permutation_space</span><span class="p">)</span>
</code></pre></div>

<p>Which gives you a <code>pd.DataFrame</code> to work with.</p>
<h2 id="the-interface">The Interface:</h2>
<p>To make things easier, msa comes with an interface function:</p>
<div class="codehilite"><pre><span></span><code><span class="n">shapley_table</span><span class="p">,</span> <span class="n">contributions</span><span class="p">,</span> <span class="n">lesion_effects</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">multiprocessing_method</span><span class="o">=</span><span class="s1">&#39;joblib&#39;</span><span class="p">,</span>
                                                             <span class="n">elements</span><span class="o">=</span><span class="n">regions</span><span class="p">,</span>
                                                             <span class="n">n_permutations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                             <span class="n">objective_function</span><span class="o">=</span><span class="n">rnd</span><span class="p">,</span>
                                                             <span class="n">n_parallel_games</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                                             <span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p>For this one, all you have to do is to provide your elements, the objective function, and specify some parameters. For example, you can choose between two different multiprocessing toolboxes <code>joblib</code> and <code>ray</code> to distribute <code>msa.take_contributions</code> over <code>n_parallel_games</code>. Specifying a <code>random_seed</code> is encouraged for reproducibility but the default is <code>None</code>.</p>
<h2 id="todo-interested-in-contributing">TODO (Interested in Contributing?):</h2>
<ul>
<li>More estimation methods, for example see: <a href="https://github.com/amiratag/neuronshapley">amiratag/neuronshapley</a>.</li>
<li>Integrating <code>ray</code> with <code>ray cluster</code>.</li>
<li>Providing built-in objective functions for common use-cases.</li>
<li>Proper documentation page.</li>
</ul>
<h2 id="cite">Cite:</h2>
<p><a href="https://doi.org/10.5281/zenodo.5636435"><img alt="DOI" src="https://zenodo.org/badge/DOI/10.5281/zenodo.5636435.svg" /></a></p>
<p>Kayson Fakhar. (2021). MSA: A compact Python package for Multiperturbation Shapley value Analysis. Zenodo. https://doi.org/10.5281/zenodo.5636435</p>
<div class="codehilite"><pre><span></span><code><span class="nl">BibTeX</span><span class="p">:</span><span class="w"></span>
<span class="nv">@software</span><span class="err">{</span><span class="n">kayson_fakhar_2021_5636435</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">author</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="n">Kayson</span><span class="w"> </span><span class="n">Fakhar</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">title</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="err">{{</span><span class="nl">MSA</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>
<span class="w">                   </span><span class="n">Multiperturbation</span><span class="w"> </span><span class="n">Shapley</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">Analysis</span><span class="p">.</span><span class="err">}}</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nf">month</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">nov</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nf">year</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">publisher</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="n">Zenodo</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">version</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="n">v0</span><span class="mf">.0.2</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">doi</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="mf">10.5281</span><span class="o">/</span><span class="n">zenodo</span><span class="mf">.5636435</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">url</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.5281</span><span class="o">/</span><span class="n">zenodo</span><span class="mf">.5636435</span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>

<h2 id="acknowledgement">Acknowledgement:</h2>
<p>I thank my good friend and Python mentor <a href="https://github.com/fabridamicelli">Fabrizio Damicelli</a>  whom I learned a lot from. Without him this package would be a disaster to look at.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="API/estimate_causal_influences.html" class="md-footer__link md-footer__link--next" aria-label="Next: Estimate causal influences" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Estimate causal influences
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.5413a266.min.js"></script>
      
    
  </body>
</html>